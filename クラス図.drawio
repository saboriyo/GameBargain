<mxfile host="65bd71144e">
    <diagram name="GameBargain クラス図" id="class-diagram">
        <mxGraphModel dx="626" dy="1809" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="user-model" value="User&lt;br&gt;────────────────&lt;br&gt;+ user_id: int&lt;br&gt;+ discord_id: str&lt;br&gt;+ username: str&lt;br&gt;+ avatar_url: str&lt;br&gt;+ email: str&lt;br&gt;+ is_active: bool&lt;br&gt;+ preferences: dict&lt;br&gt;────────────────&lt;br&gt;+ get_favorites(): List[Favorite]&lt;br&gt;+ add_favorite(game_id): Favorite&lt;br&gt;+ remove_favorite(game_id): bool" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="50" y="-50" width="200" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="game-model" value="Game&lt;br&gt;─────────────────&lt;br&gt;+ game_id: int&lt;br&gt;+ title: str&lt;br&gt;+ developer: str&lt;br&gt;+ steam_app_id: str&lt;br&gt;+ epic_game_id: str&lt;br&gt;+ image_url: str&lt;br&gt;+ genres: List[str]&lt;br&gt;+ is_active: bool&lt;br&gt;─────────────────&lt;br&gt;+ get_current_prices(): List[Price]&lt;br&gt;+ get_price_history(): List[PriceHistory]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="300" y="-30" width="220" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="price-model" value="Price&lt;br&gt;────────────────&lt;br&gt;+ price_id: int&lt;br&gt;+ game_id: int&lt;br&gt;+ store: str&lt;br&gt;+ regular_price: Decimal&lt;br&gt;+ sale_price: Decimal&lt;br&gt;+ discount_rate: int&lt;br&gt;+ is_on_sale: bool&lt;br&gt;+ store_url: str&lt;br&gt;─────────────────&lt;br&gt;+ get_effective_price(): Decimal&lt;br&gt;+ is_cheaper_than(other): bool" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="620" y="-30" width="200" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="favorite-model" value="Favorite&lt;br&gt;────────────────&lt;br&gt;+ favorite_id: int&lt;br&gt;+ user_id: int&lt;br&gt;+ game_id: int&lt;br&gt;+ notification_enabled: bool&lt;br&gt;+ price_threshold: Decimal&lt;br&gt;+ created_at: datetime&lt;br&gt;─────────────────&lt;br&gt;+ should_notify(price): bool&lt;br&gt;+ update_threshold(price): void" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="40" y="240" width="200" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="game-search-service" value="GameSearchService&#xa;─────────────────────&#xa;- steam_client: SteamAPIClient&#xa;- epic_client: EpicAPIClient&#xa;- game_repository: GameRepository&#xa;─────────────────────&#xa;+ search_games(query, filters): SearchResult&#xa;+ _search_local_games(): List[Game]&#xa;+ _search_external_apis(): List[Game]&#xa;+ _merge_results(): List[Game]&#xa;+ _enrich_with_prices(): List[Game]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="840" y="-30" width="260" height="190" as="geometry"/>
                </mxCell>
                <mxCell id="price-comparison-service" value="PriceComparisonService&#xa;─────────────────────&#xa;- price_repository: PriceRepository&#xa;─────────────────────&#xa;+ compare_prices(game_id): PriceComparison&#xa;+ _find_cheapest_price(): PriceInfo&#xa;+ _calculate_discounts(): DiscountInfo" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="130" y="470" width="260" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="enhanced-price-service" value="EnhancedPriceComparisonService&#xa;─────────────────────&#xa;- steam_client: SteamAPIClient&#xa;- epic_client: EpicAPIClient&#xa;─────────────────────&#xa;+ get_real_time_prices(): PriceComparison&#xa;+ _get_steam_price(): PriceInfo&#xa;+ _get_epic_price(): PriceInfo" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="60" y="700" width="260" height="155" as="geometry"/>
                </mxCell>
                <mxCell id="favorite-service" value="FavoriteService&#xa;─────────────────────&#xa;- user_repository: UserRepository&#xa;- game_repository: GameRepository&#xa;- favorite_repository: FavoriteRepository&#xa;─────────────────────&#xa;+ add_favorite(): Favorite&#xa;+ remove_favorite(): bool&#xa;+ get_user_favorites(): List[GameWithFavorite]&#xa;+ update_notification_settings(): Favorite" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="560" y="340" width="280" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="notification-service" value="NotificationService&#xa;─────────────────────&#xa;- discord_bot: DiscordBot&#xa;- user_repository: UserRepository&#xa;─────────────────────&#xa;+ create_price_notification(): Notification&#xa;+ _generate_notification_message(): str&#xa;+ _send_discord_notification(): bool" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="880" y="660" width="280" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="steam-api-client" value="SteamAPIClient&lt;br&gt;──────────────────&lt;br&gt;- api_key: str&lt;br&gt;- base_url: str&lt;br&gt;- rate_limiter: RateLimiter&lt;br&gt;──────────────────&lt;br&gt;+ search_games(query): List[SteamGame]&lt;br&gt;+ get_app_details(app_id): SteamGameDetail" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="1220" y="-20" width="240" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="epic-api-client" value="EpicAPIClient&lt;br&gt;───────────────────&lt;br&gt;- base_url: str&lt;br&gt;- rate_limiter: RateLimiter&lt;br&gt;───────────────────&lt;br&gt;+ search_games(query): List[EpicGame]&lt;br&gt;+ get_game_details(): EpicGameDetail" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="1180" y="210" width="240" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="user-repository" value="UserRepository&lt;br&gt;──────────────&lt;br&gt;+ get_by_id(user_id): User&lt;br&gt;+ get_by_discord_id(): User&lt;br&gt;+ save(user): User&lt;br&gt;+ update(user): User" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="660" y="790" width="180" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="game-repository" value="GameRepository&lt;br&gt;──────────────&lt;br&gt;+ get_by_id(game_id): Game&lt;br&gt;+ search_by_title(): List[Game]&lt;br&gt;+ save(game): Game&lt;br&gt;+ get_active_games(): List[Game]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="850" y="230" width="180" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="price-repository" value="PriceRepository&lt;br&gt;────────────────&lt;br&gt;+ get_latest_prices(): List[Price]&lt;br&gt;+ save_price_history(): void&lt;br&gt;+ get_users_for_notification(): List[User]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="360" y="730" width="200" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="favorite-repository" value="FavoriteRepository&lt;br&gt;──────────────&lt;br&gt;+ get_by_user_game(): Favorite&lt;br&gt;+ get_user_favorites(): List[Favorite]&lt;br&gt;+ save(favorite): Favorite&lt;br&gt;+ delete(favorite_id): bool" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="610" y="550" width="180" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="discord-auth-service" value="DiscordAuthService&lt;br&gt;──────────────────&lt;br&gt;- client_id: str&lt;br&gt;- client_secret: str&lt;br&gt;- oauth: OAuth&lt;br&gt;──────────────────&lt;br&gt;+ get_authorization_url(): str&lt;br&gt;+ handle_callback(): DiscordUser&lt;br&gt;+ _get_avatar_url(): str&lt;br&gt;+ _get_user_guilds(): list" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="310" y="260" width="220" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="price-change-detector" value="PriceChangeDetector&#xa;─────────────────────&#xa;- price_repository: PriceRepository&#xa;- notification_service: NotificationService&#xa;─────────────────────&#xa;+ detect_price_changes(): List[PriceChange]&#xa;+ process_price_changes(): void&#xa;+ _determine_change_type(): str&#xa;+ _get_users_to_notify(): List[User]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontFamily=monospace;" parent="1" vertex="1">
                    <mxGeometry x="910" y="400" width="260" height="190" as="geometry"/>
                </mxCell>
                <mxCell id="user-favorite-relation" parent="1" source="user-model" target="favorite-model" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="game-price-relation" parent="1" source="game-model" target="price-model" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="game-favorite-relation" parent="1" source="game-model" target="favorite-model" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="search-service-steam" parent="1" source="game-search-service" target="steam-api-client" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="search-service-epic" parent="1" source="game-search-service" target="epic-api-client" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="enhanced-price-inheritance" parent="1" source="enhanced-price-service" target="price-comparison-service" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="search-service-game-repo" parent="1" source="game-search-service" target="game-repository" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="price-service-price-repo" parent="1" source="price-comparison-service" target="price-repository" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="favorite-service-repos" parent="1" source="favorite-service" target="favorite-repository" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="notification-user-repo" parent="1" source="notification-service" target="user-repository" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="detector-notification" parent="1" source="price-change-detector" target="notification-service" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>