# GameBargain åŸºæœ¬è¨­è¨ˆæ›¸

## ç›®æ¬¡
1. [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆè¨­è¨ˆ](#1-ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆè¨­è¨ˆ)
2. [æ©Ÿèƒ½è¨­è¨ˆ](#2-æ©Ÿèƒ½è¨­è¨ˆ)
3. [ç”»é¢è¨­è¨ˆ](#3-ç”»é¢è¨­è¨ˆ)
4. [ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ](#4-ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ)
5. [APIè¨­è¨ˆ](#5-apiè¨­è¨ˆ)
6. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#6-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆè¨­è¨ˆ

### 1.1 ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆå›³
![alt text](ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³.drawio.png)

### 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
| åˆ†é¡ | æŠ€è¡“ | ç†ç”± |
|------|------|------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Jinja2 + Bootstrap 5 | ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€é–‹ç™ºåŠ¹ç‡è‰¯ |
| JavaScript | Vanilla JSï¼ˆæœ€å°é™ï¼‰ | è»½é‡ã€å­¦ç¿’ã‚³ã‚¹ãƒˆä½ |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Flask + Discord.py | Pythonçµ±ä¸€ã€è»½é‡ |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | SQLite | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã€é‹ç”¨ã‚³ã‚¹ãƒˆä½ |
| èªè¨¼ | Discord OAuth2 | æ¨™æº–çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ |
| ãƒ‡ãƒ—ãƒ­ã‚¤ | è‡ªå®…é¯–/å­¦ç§‘ã‚µãƒ¼ãƒãƒ¼ | ã‚³ã‚¹ãƒˆå‰Šæ¸› |

### 1.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ
```
gamebargain/
â”œâ”€â”€ app.py                      # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ config.py                   # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ requirements.txt            # ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ discord_bot/                # Discord Bot ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ bot.py                  # Botå®Ÿè£…
â”‚   â””â”€â”€ commands.py             # ã‚³ãƒãƒ³ãƒ‰å®šç¾©
â”œâ”€â”€ web/                        # Webé–¢é€£
â”‚   â”œâ”€â”€ routes.py               # Flaskãƒ«ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ auth.py                 # èªè¨¼å‡¦ç†
â”‚   â””â”€â”€ forms.py                # ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
â”œâ”€â”€ services/                   # å…±é€šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ game_service.py         # ã‚²ãƒ¼ãƒ æ¤œç´¢ãƒ»ä¾¡æ ¼æ¯”è¼ƒ
â”‚   â”œâ”€â”€ price_service.py        # ä¾¡æ ¼ç›£è¦–ãƒ»æ›´æ–°
â”‚   â””â”€â”€ notification_service.py # é€šçŸ¥å‡¦ç†
â”œâ”€â”€ models/                     # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user.py                 # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ game.py                 # ã‚²ãƒ¼ãƒ ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ price.py                # ä¾¡æ ¼ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ templates/                  # Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ base.html               # ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ components/             # å†åˆ©ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ navbar.html         # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼
â”‚   â”‚   â”œâ”€â”€ game_card.html      # ã‚²ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰
â”‚   â”‚   â””â”€â”€ price_table.html    # ä¾¡æ ¼ãƒ†ãƒ¼ãƒ–ãƒ«
â”‚   â”œâ”€â”€ index.html              # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ search.html             # æ¤œç´¢çµæœ
â”‚   â”œâ”€â”€ user.html               # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ login.html              # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â””â”€â”€ game_detail.html        # ã‚²ãƒ¼ãƒ è©³ç´°ãƒšãƒ¼ã‚¸
â”œâ”€â”€ static/                     # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â””â”€â”€ data/
    â””â”€â”€ gamebargain.db          # SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
```

### 1.4 Discord Bot çµ±åˆè¨­è¨ˆ

#### çµ±åˆã®ãƒ¡ãƒªãƒƒãƒˆ
- **ã‚³ãƒ¼ãƒ‰å…±æœ‰**: ä¾¡æ ¼æ¯”è¼ƒãƒ­ã‚¸ãƒƒã‚¯ã‚’Webãƒ»Botä¸¡æ–¹ã§ä½¿ç”¨
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±ä¸€**: åŒä¸€SQLiteã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½¿ç”¨
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥**: ä¾¡æ ¼å¤‰å‹•æ™‚ã«å³åº§ã«Discordé€šçŸ¥
- **é‹ç”¨åŠ¹ç‡**: å˜ä¸€ãƒ—ãƒ­ã‚»ã‚¹ãƒ»å˜ä¸€ãƒ‡ãƒ—ãƒ­ã‚¤ã§ç®¡ç†

#### çµ±åˆå®Ÿè£…ä¾‹
```python
# app.py
from flask import Flask
from discord_bot import create_bot
import threading

def create_app():
    app = Flask(__name__)
    
    # Web routes
    from web.routes import register_routes
    register_routes(app)
    
    # Discord Bot (åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰)
    bot = create_bot()
    bot_thread = threading.Thread(target=bot.run, args=[DISCORD_TOKEN])
    bot_thread.daemon = True
    bot_thread.start()
    
    return app
```

---

## 2. æ©Ÿèƒ½è¨­è¨ˆ

### 2.1 MVPæ©Ÿèƒ½ä¸€è¦§
| æ©Ÿèƒ½ID | æ©Ÿèƒ½å | å„ªå…ˆåº¦ | å·¥æ•° | èª¬æ˜ |
|--------|---------|---------|------|------|
| F001 | ã‚²ãƒ¼ãƒ æ¤œç´¢ | æœ€é«˜ | 3æ—¥ | Steam APIã§ã‚²ãƒ¼ãƒ æ¤œç´¢ |
| F002 | ä¾¡æ ¼æ¯”è¼ƒ | æœ€é«˜ | 4æ—¥ | è¤‡æ•°ã‚¹ãƒˆã‚¢ã®ä¾¡æ ¼æ¯”è¼ƒãƒ»æœ€å®‰å€¤è¡¨ç¤º |
| F003 | Discordèªè¨¼ | é«˜ | 3æ—¥ | OAuth2ã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³ |
| F004 | ãŠæ°—ã«å…¥ã‚Š | ä¸­ | 2æ—¥ | ã‚²ãƒ¼ãƒ ã®ãŠæ°—ã«å…¥ã‚Šç™»éŒ² |
| F005 | Discord Bot | ä¸­ | 4æ—¥ | åŸºæœ¬çš„ãªBotæ©Ÿèƒ½ |
| F006 | ä¾¡æ ¼ç›£è¦– | ä¸­ | 3æ—¥ | ä¾¡æ ¼å¤‰å‹•ç›£è¦–ãƒ»é€šçŸ¥ |

### 2.2 ä¸»è¦æ©Ÿèƒ½è¨­è¨ˆ

#### F001: ã‚²ãƒ¼ãƒ æ¤œç´¢æ©Ÿèƒ½
```python
def search_games(title):
    # 1. å…¥åŠ›å€¤æ¤œè¨¼
    if not title or len(title) < 2:
        return {"error": "æ¤œç´¢æ–‡å­—ã¯2æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„"}
    
    # 2. Steam APIæ¤œç´¢
    steam_results = steam_api.search_games(title)
    
    # 3. ä¾¡æ ¼æƒ…å ±ä»˜ä¸
    for game in steam_results:
        game['prices'] = get_current_prices(game['id'])
    
    return steam_results
```

#### F002: ä¾¡æ ¼æ¯”è¼ƒæ©Ÿèƒ½
```python
def compare_prices(game_id):
    # 1. ã‚²ãƒ¼ãƒ æƒ…å ±å–å¾—
    game = db.get_game(game_id)
    
    # 2. Steamä¾¡æ ¼å–å¾—
    steam_price = steam_api.get_price(game['steam_app_id'])
    
    # 3. æœ€å®‰å€¤åˆ¤å®š
    best_deal = {
        "store": "steam",
        "price": steam_price,
        "discount": steam_price.get('discount', 0)
    }
    
    return {"game": game, "best_deal": best_deal}
```

#### F005: Discord Botæ©Ÿèƒ½
```python
@bot.command(name='search')
async def search_command(ctx, *, title):
    results = search_games(title)  # å…±é€šã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨
    embed = create_search_embed(results)
    await ctx.send(embed=embed)

@bot.command(name='favorite')
async def favorite_command(ctx, *, title):
    user_id = get_user_by_discord_id(ctx.author.id)
    game = find_game_by_title(title)
    add_to_favorites(user_id, game['id'])
    await ctx.send(f"âœ… {title} ã‚’ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã—ã¾ã—ãŸï¼")
```

---

## 3. ç”»é¢è¨­è¨ˆ

### 3.1 ä¸»è¦ç”»é¢ä¸€è¦§
1. **ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸** - ã‚²ãƒ¼ãƒ æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã€ãŠã™ã™ã‚ã‚»ãƒ¼ãƒ«
2. **æ¤œç´¢çµæœãƒšãƒ¼ã‚¸** - ä¾¡æ ¼æ¯”è¼ƒçµæœã€è³¼å…¥ãƒªãƒ³ã‚¯
3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒšãƒ¼ã‚¸** - ãŠæ°—ã«å…¥ã‚Šã€é€šçŸ¥è¨­å®š
4. **ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸** - Discord OAuthèªè¨¼
5. **ã‚²ãƒ¼ãƒ è©³ç´°ãƒšãƒ¼ã‚¸** - ä¾¡æ ¼æ¨ç§»ã‚°ãƒ©ãƒ•ã€ã‚¹ãƒˆã‚¢ãƒªãƒ³ã‚¯ã€å¤‰å‹•å±¥æ­´

### 3.2 ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ è©³ç´°è¨­è¨ˆ
![ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ](ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ .drawio.png)

ãƒ¢ãƒ€ãƒ³ãªãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã¨å†åˆ©ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ´»ç”¨ã—ãŸå…¨ç”»é¢ã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã¯ä¸Šè¨˜ã‚’å‚ç…§ã€‚

### 3.3 ç”»é¢æ§‹æˆï¼ˆç°¡ç•¥ç‰ˆï¼‰

#### ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GameBargain                    [ãƒ­ã‚°ã‚¤ãƒ³] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        ã‚²ãƒ¼ãƒ ä¾¡æ ¼æ¯”è¼ƒã‚µãƒ¼ãƒ“ã‚¹              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [æ¤œç´¢]              â”‚
â”‚  â”‚ ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  ä»Šæ—¥ã®ãŠã™ã™ã‚ã‚»ãƒ¼ãƒ«                      â”‚
â”‚  [ã‚²ãƒ¼ãƒ 1 50%OFF] [ã‚²ãƒ¼ãƒ 2 30%OFF]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¤œç´¢çµæœãƒšãƒ¼ã‚¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¤œç´¢çµæœ: "Cyberpunk 2077"               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Cyberpunk 2077           [â™¡ãŠæ°—ã«å…¥ã‚Š] â”‚ â”‚
â”‚ â”‚ æœ€å®‰å€¤: Steam Â¥3,000                â”‚ â”‚
â”‚ â”‚ [Steamã§è³¼å…¥] [ï¿½è©³ç´°ã‚’è¦‹ã‚‹]         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚²ãƒ¼ãƒ è©³ç´°ãƒšãƒ¼ã‚¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ® Cyberpunk 2077            [â† æˆ»ã‚‹]   â”‚
â”‚ ç¾åœ¨ä¾¡æ ¼: Â¥3,000 (Steam) - 50% OFF     â”‚
â”‚                        [â™¡ãŠæ°—ã«å…¥ã‚Šè¿½åŠ ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ›’ ã‚¹ãƒˆã‚¢ãƒªãƒ³ã‚¯                         â”‚
â”‚ [ğŸŸ¦ Steam - Â¥3,000 (50%OFF)]           â”‚
â”‚ [â¬œ Epic Games - Â¥6,000]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š ä¾¡æ ¼æ¨ç§»ã‚°ãƒ©ãƒ• (éå»30æ—¥)            â”‚
â”‚ [ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚¨ãƒªã‚¢]                      â”‚
â”‚ ğŸ“‹ ä¾¡æ ¼å¤‰å‹•å±¥æ­´                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 å†åˆ©ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ
- **navbar.html** - ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ­ã‚´ã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã€å‹•çš„ãƒœã‚¿ãƒ³è¡¨ç¤º
- **game_card.html** - ç”»åƒã€ã‚¿ã‚¤ãƒˆãƒ«ã€ä¾¡æ ¼ãƒãƒƒã‚¸ã€ãƒ›ãƒãƒ¼åŠ¹æœ
- **price_table.html** - ä¾¡æ ¼æ¯”è¼ƒã€å‰²å¼•è¡¨ç¤ºã€è³¼å…¥ãƒªãƒ³ã‚¯

---

## 4. ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ

### 4.1 ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼ˆMVPç‰ˆï¼‰

#### usersãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    discord_id VARCHAR(20) UNIQUE NOT NULL,
    username VARCHAR(100) NOT NULL,
    avatar_url VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### gamesãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE games (
    game_id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(200) NOT NULL,
    developer VARCHAR(100),
    steam_app_id VARCHAR(20) UNIQUE,
    image_url VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### pricesãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE prices (
    price_id INTEGER PRIMARY KEY AUTOINCREMENT,
    game_id INTEGER NOT NULL,
    store VARCHAR(20) NOT NULL DEFAULT 'steam',
    regular_price DECIMAL(10,2),
    sale_price DECIMAL(10,2),
    discount_rate INTEGER DEFAULT 0,
    is_on_sale BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (game_id) REFERENCES games(game_id)
);
```

#### user_favoritesãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE user_favorites (
    favorite_id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    game_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (game_id) REFERENCES games(game_id)
);
```

---

## 5. APIè¨­è¨ˆ

### 5.1 Web API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```
GET  /                      # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
GET  /search?q={title}      # æ¤œç´¢çµæœãƒšãƒ¼ã‚¸
GET  /game/{id}             # ã‚²ãƒ¼ãƒ è©³ç´°ãƒšãƒ¼ã‚¸ï¼ˆä¾¡æ ¼æ¨ç§»ãƒ»ã‚¹ãƒˆã‚¢ãƒªãƒ³ã‚¯å«ã‚€ï¼‰
GET  /user                  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒšãƒ¼ã‚¸
POST /user/favorites        # ãŠæ°—ã«å…¥ã‚Šè¿½åŠ 
GET  /auth/discord          # Discordèªè¨¼
GET  /auth/callback         # èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
```

### 5.2 Discord Bot ã‚³ãƒãƒ³ãƒ‰
```
!gb search <title>          # ã‚²ãƒ¼ãƒ æ¤œç´¢
!gb price <title>           # ä¾¡æ ¼ç¢ºèª
!gb favorite <title>        # ãŠæ°—ã«å…¥ã‚Šè¿½åŠ 
!gb help                    # ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
```

### 5.3 å¤–éƒ¨APIçµ±åˆ

#### Steam Storefront API
```python
# Steam API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
class SteamAPI:
    BASE_URL = "https://store.steampowered.com/api"
    SEARCH_URL = "https://store.steampowered.com/search/suggest"
    
    def __init__(self):
        self.session = requests.Session()
        # ãƒ¬ãƒ¼ãƒˆåˆ¶é™: 1ç§’ã‚ãŸã‚Šæœ€å¤§10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        self.rate_limiter = RateLimiter(max_calls=10, period=1)
    
    def search_games(self, query):
        """ã‚²ãƒ¼ãƒ æ¤œç´¢"""
        params = {
            'term': query,
            'f': 'games',
            'cc': 'JP'  # æ—¥æœ¬å††ä¾¡æ ¼
        }
        response = self.session.get(self.SEARCH_URL, params=params)
        return self._parse_search_results(response.json())
    
    def get_game_details(self, app_id):
        """ã‚²ãƒ¼ãƒ è©³ç´°ãƒ»ä¾¡æ ¼å–å¾—"""
        url = f"{self.BASE_URL}/appdetails"
        params = {
            'appids': app_id,
            'cc': 'JP',  # æ—¥æœ¬å††
            'l': 'japanese'  # æ—¥æœ¬èª
        }
        
        with self.rate_limiter:
            response = self.session.get(url, params=params)
            data = response.json()
            
        if str(app_id) in data and data[str(app_id)]['success']:
            return self._parse_game_data(data[str(app_id)]['data'])
        return None
    
    def _parse_game_data(self, data):
        """Steam APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è§£æ"""
        price_info = data.get('price_overview', {})
        return {
            'title': data.get('name'),
            'developer': data.get('developers', []),
            'image_url': data.get('header_image'),
            'steam_app_id': data.get('steam_appid'),
            'regular_price': price_info.get('initial', 0) / 100,  # ã‚»ãƒ³ãƒˆâ†’å††
            'sale_price': price_info.get('final', 0) / 100,
            'discount_rate': price_info.get('discount_percent', 0),
            'is_on_sale': price_info.get('discount_percent', 0) > 0,
            'store': 'steam'
        }
```

#### Epic Games éå…¬å¼API
```python
# Epic Games API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
class EpicGamesAPI:
    BASE_URL = "https://store-site-backend-static.ak.epicgames.com"
    GRAPHQL_URL = "https://graphql.epicgames.com/graphql"
    
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })
    
    def get_free_games_promotions(self):
        """ç„¡æ–™ã‚²ãƒ¼ãƒ ãƒ»ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±å–å¾—"""
        url = f"{self.BASE_URL}/freeGamesPromotions"
        params = {'locale': 'ja', 'country': 'JP'}
        
        try:
            response = self.session.get(url, params=params)
            data = response.json()
            return self._parse_promotions(data)
        except Exception as e:
            logger.error(f"Epic Games API error: {e}")
            return []
    
    def search_games(self, query):
        """ã‚²ãƒ¼ãƒ æ¤œç´¢ï¼ˆGraphQLï¼‰"""
        # æ³¨æ„: éå…¬å¼APIã®ãŸã‚ã€æ§‹é€ ãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚ã‚Š
        graphql_query = {
            "query": """
            query searchStoreQuery($query: String!, $locale: String!, $country: String!) {
                Catalog {
                    searchStore(query: $query, locale: $locale, country: $country) {
                        elements {
                            title
                            id
                            namespace
                            description
                            keyImages {
                                type
                                url
                            }
                            price(country: $country) {
                                totalPrice {
                                    discountPrice
                                    originalPrice
                                    currencyCode
                                }
                            }
                        }
                    }
                }
            }""",
            "variables": {
                "query": query,
                "locale": "ja-JP",
                "country": "JP"
            }
        }
        
        try:
            response = self.session.post(self.GRAPHQL_URL, json=graphql_query)
            return self._parse_search_results(response.json())
        except Exception as e:
            logger.error(f"Epic GraphQL error: {e}")
            return []
    
    def _parse_promotions(self, data):
        """ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ"""
        games = []
        for element in data.get('data', {}).get('Catalog', {}).get('searchStore', {}).get('elements', []):
            price = element.get('price', {}).get('totalPrice', {})
            games.append({
                'title': element.get('title'),
                'epic_id': element.get('id'),
                'image_url': self._get_image_url(element.get('keyImages', [])),
                'regular_price': price.get('originalPrice', 0) / 100,
                'sale_price': price.get('discountPrice', 0) / 100,
                'discount_rate': self._calculate_discount(price),
                'is_on_sale': price.get('discountPrice', 0) < price.get('originalPrice', 0),
                'store': 'epic'
            })
        return games
```

#### APIçµ±åˆã‚µãƒ¼ãƒ“ã‚¹
```python
class PriceComparisonService:
    def __init__(self):
        self.steam_api = SteamAPI()
        self.epic_api = EpicGamesAPI()
    
    async def search_all_stores(self, query):
        """å…¨ã‚¹ãƒˆã‚¢ã§ã‚²ãƒ¼ãƒ æ¤œç´¢"""
        results = {
            'steam': [],
            'epic': [],
            'merged': []
        }
        
        # ä¸¦è¡Œå®Ÿè¡Œã§é«˜é€ŸåŒ–
        steam_task = asyncio.create_task(self.steam_api.search_games(query))
        epic_task = asyncio.create_task(self.epic_api.search_games(query))
        
        results['steam'] = await steam_task
        results['epic'] = await epic_task
        results['merged'] = self._merge_results(results['steam'], results['epic'])
        
        return results
    
    def _merge_results(self, steam_games, epic_games):
        """ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒƒãƒãƒ³ã‚°ã§çµæœã‚’ãƒãƒ¼ã‚¸"""
        merged = []
        for steam_game in steam_games:
            # Epic Gamesã§åŒã˜ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ¤œç´¢
            epic_match = self._find_matching_game(steam_game['title'], epic_games)
            
            game_data = steam_game.copy()
            if epic_match:
                game_data['epic_price'] = epic_match
                game_data['best_price'] = min(
                    steam_game.get('sale_price', float('inf')),
                    epic_match.get('sale_price', float('inf'))
                )
            
            merged.append(game_data)
        
        return merged
```

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒ¬ãƒ¼ãƒˆåˆ¶é™
```python
# ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¯ãƒ©ã‚¹
class RateLimiter:
    def __init__(self, max_calls, period):
        self.max_calls = max_calls
        self.period = period
        self.calls = []
    
    def __enter__(self):
        now = time.time()
        # å¤ã„ã‚³ãƒ¼ãƒ«ã‚’å‰Šé™¤
        self.calls = [call_time for call_time in self.calls 
                     if now - call_time < self.period]
        
        if len(self.calls) >= self.max_calls:
            sleep_time = self.period - (now - self.calls[0])
            if sleep_time > 0:
                time.sleep(sleep_time)
        
        self.calls.append(now)
    
    def __exit__(self, *args):
        pass

# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
@retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=1, min=4, max=10))
def api_call_with_retry(func, *args, **kwargs):
    """APIã‚³ãƒ¼ãƒ«ç”¨ã®ãƒªãƒˆãƒ©ã‚¤ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿"""
    try:
        return func(*args, **kwargs)
    except requests.exceptions.RequestException as e:
        logger.warning(f"API call failed, retrying: {e}")
        raise
    except Exception as e:
        logger.error(f"Unexpected error in API call: {e}")
        raise
```

#### æ³¨æ„äº‹é …
- **Steam API**: å…¬å¼APIã®ãŸã‚å®‰å®šã€ãŸã ã—ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚ã‚Š
- **Epic Games API**: éå…¬å¼ã®ãŸã‚æ§‹é€ å¤‰æ›´ãƒªã‚¹ã‚¯ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°é‡è¦
- **ä¾¡æ ¼å–å¾—é »åº¦**: 1æ—¥1-2å›ç¨‹åº¦ã«åˆ¶é™ã—ã€ã‚µãƒ¼ãƒãƒ¼è² è·ã‚’è»½æ¸›
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: ä¾¡æ ¼æƒ…å ±ã¯1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã‚²ãƒ¼ãƒ æƒ…å ±ã¯24æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥

---

## 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 6.1 åŸºæœ¬ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–
- **Discord OAuth2**: å®‰å…¨ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
- **CSRFå¯¾ç­–**: Flask-WTFä½¿ç”¨
- **SQL Injectionå¯¾ç­–**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒª
- **XSSå¯¾ç­–**: Jinja2ã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- **ç’°å¢ƒå¤‰æ•°**: æ©Ÿå¯†æƒ…å ±ã®é©åˆ‡ãªç®¡ç†

### 6.2 APIåˆ¶é™
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: Steam APIå‘¼ã³å‡ºã—é »åº¦åˆ¶é™
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- **ãƒ­ã‚°ç›£è¦–**: ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œçŸ¥

---

## 7. é–‹ç™ºãƒ»é‹ç”¨

### 7.1 é–‹ç™ºç’°å¢ƒ
```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install flask discord.py requests python-dotenv

# ç’°å¢ƒå¤‰æ•°è¨­å®š
DISCORD_CLIENT_ID=your_client_id
DISCORD_CLIENT_SECRET=your_client_secret
DISCORD_BOT_TOKEN=your_bot_token
STEAM_API_KEY=your_steam_api_key
```

### 7.2 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»é‹ç”¨
- **å˜ä¸€ãƒ—ãƒ­ã‚»ã‚¹**: Flask + Discord Botçµ±åˆå®Ÿè¡Œ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLiteãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹
- **ãƒ­ã‚°**: æ¨™æº–å‡ºåŠ› + ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
- **ç›£è¦–**: ãƒ—ãƒ­ã‚»ã‚¹æ­»æ´»ç›£è¦–ã®ã¿

### 7.3 ç®¡ç†ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
```bash
# ãƒ­ã‚°ç¢ºèª
tail -f logs/gamebargain.log

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æ¥æ“ä½œ
sqlite3 data/gamebargain.db
> SELECT * FROM users;
> SELECT * FROM prices WHERE created_at > datetime('now', '-1 day');

# ä¾¡æ ¼åŒæœŸã®æ‰‹å‹•å®Ÿè¡Œ
python -c "from services.price_service import sync_all_prices; sync_all_prices()"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp data/gamebargain.db backups/gamebargain_$(date +%Y%m%d).db
```

**ç®¡ç†ç”»é¢ã‚’å‰Šé™¤ã—ãŸç†ç”±**:
- ã‚²ãƒ¼ãƒ æƒ…å ±ã¯ Steam API ã‹ã‚‰è‡ªå‹•å–å¾—
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã¯ Discord OAuth ã§è‡ªå‹•åŒ–
- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ã¯ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»DBã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ååˆ†
- MVPã«é›†ä¸­ã—ã€é–‹ç™ºå·¥æ•°ã‚’å‰Šæ¸›

---

